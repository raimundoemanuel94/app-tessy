<!-- ... (todo o conteúdo acima continua igual) -->

</table>

<hr>
<button id="adminBtn" style="margin-top: 30px; background-color: #444; color: white;">
  🔐 Área da Tessy (Admin)
</button>
</div>

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('✅ Service Worker registrado com sucesso'));
}

let bloqueiosFormatados = [];

fetch('https://opensheet.elk.sh/13DOG0PR-amOiFyLiGRMBqQOGSKDOQh116fNhvdbA0iE/Página1')
  .then(res => res.json())
  .then(data => {
    const horariosIndisponiveis = data.slice(1).map(row => row.DataHora);
    bloqueiosFormatados = horariosIndisponiveis;

    const bloqueios = horariosIndisponiveis.map(str => {
      const [dia, hora] = str.split(" ");
      const [d, m, y] = dia.split("/");
      const [h, i] = hora.split(":");
      return new Date(`${y}-${m}-${d}T${h}:${i}`);
    });

    flatpickr("#dataHora", {
      enableTime: true,
      dateFormat: "d/m/Y H:i",
      time_24hr: true,
      locale: "pt",
      minTime: "07:00",
      maxTime: "17:00",
      disable: [
        date => date.getDay() === 0,
        ...bloqueios
      ]
    });
  });

const form = document.getElementById('form-agendamento');

form.addEventListener('submit', function (event) {
  event.preventDefault();

  const nome = form.elements[0].value;
  const dataHora = form.elements[1].value;
  const servico = form.elements[2].value;

  if (bloqueiosFormatados.includes(dataHora)) {
    alert("❌ Este horário já está reservado. Por favor, escolha outro.");
    return;
  }

  fetch('https://script.google.com/macros/s/AKfycbyWbg8wpxtQLoFWxZOvAu-DNTs_89UVmxkQNtaB3MxzrDowqO-sxULuCRl-NckeqKxAjw/exec', {
    method: 'POST',
    mode: 'no-cors',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ nome, dataHora, servico })
  })
  .then(() => {
    alert(`✅ Agendamento registrado:\n\nNome: ${nome}\nData/Hora: ${dataHora}\nServiço: ${servico}`);
    form.reset();

    const msg = `Olá, Tessy! Gostaria de confirmar meu agendamento:%0ANome: ${nome}%0AServiço: ${servico}%0AData/Hora: ${dataHora}`;
    const whatsappURL = `https://wa.me/556681499177?text=${msg}`;
    const btn = document.getElementById('whatsappBtn');
    btn.style.display = 'block';
    btn.onclick = () => window.open(whatsappURL, '_blank');
  })
  .catch((err) => {
    console.error("Erro:", err);
    alert("❌ Erro ao enviar agendamento.");
  });
});

// 🔐 Função para entrar na área admin
document.getElementById("adminBtn").addEventListener("click", () => {
  const senha = prompt("Área restrita. Digite a senha:");
  if (senha === "tessy123") {
    window.location.href = "admin.html";
  } else {
    alert("❌ Senha incorreta.");
  }
});
</script>
</body>
</html>
